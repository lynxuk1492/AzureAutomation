workflow Stop-VMs
{
	Param (
		[string]$VMServiceName
	)
		
	$Cred = Get-AutomationPSCredential -Name ''
	$Null = Add-AzureAccount -Credential $Cred -ErrorAction Stop

	$SubID = Get-AutomationVariable -Name 'SubscriptionId'
	$Null = Set-AzureSubscription -SubscriptionId $SubID

	$VMList = Get-azureVM |Where-Object {$_.ServiceName -Like "$VMServiceName*"}

	ForEach ($VM in $VMList)
	{
		$VM.Name
		Stop-AzureVM -Name $VM.Name -ServiceName $VM.ServiceName -Force
	}
	
}